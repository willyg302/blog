<!--
layout: post
title: (Almost) Proper Cross-Browser Timestamps
date: 2014-09-09T21:57:52.310916
comments: true
categories: Web Development
-->

<p>While making this blog, one of the things I had to do was figure out a way to represent post timestamps. These are used not only for sorting and filtering posts by date, but to display the date a post was written in a pretty, human-readable format.</p>
<!-- more -->

<p>My current system is pretty simple. I have automated the creation of new posts in Markdown via a Python script, which injects the current time as a timestamp in an HTML comment. When the blog is built, the same Python script parses the comment and aggregates post information into a JSON file, which Angular can then request and use. The timestamp is available as the string <code>post.date</code>, and displaying the date nicely is as simple as <code>post.date | date:&#39;EEEE, MMMM d y&#39;</code> (using Angular&#39;s date filter).</p>
<p>The system worked great so I pushed it out. Then I later accessed my blog from a mobile device and was surprised to see &quot;undefined, undefined NaN NaN&quot; where the date should have been.</p>
<p>Turns out that JavaScript&#39;s date support is not consistent across browsers: in particular, mobile browsers lag significantly behind. So I set out in search for a timestamp format that would work across &quot;all&quot; browsers (that I could test).</p>
<p>Thankfully, my journey wasn&#39;t terribly difficult. I was concurrently working on <a href="https://github.com/willyg302/Noat">a project</a> that used both App Engine and Angular, and happened to notice that App Engine&#39;s date format worked in mobile browsers without any problems. App Engine&#39;s format looks something like this: <code>2014-09-09T21:57:52.310916</code>. You can get such a timestamp in Python with the following code:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span><span class="hljs-params">(s)</span>:</span>
    print(s)

hammer_time = datetime.utcnow().strftime(<span class="hljs-string">'%Y-%m-%dT%H:%M:%S.%f'</span>)
stop(hammer_time)
</code></pre>
<p>Terrible puns aside, it&#39;s important to call <code>utcnow()</code> instead of <code>now()</code> so that time zone information is retained by normalizing to UTC.</p>
<p>Of course, JavaScript is notorious for being difficult to get 100% right, so I&#39;m sure there&#39;s some obscure version of Opera or IE7 that this will break in. If you absolutely have to have your dates work no matter what, it&#39;s best to depend on a proven library like <a href="http://momentjs.com/">Moment.js</a>. My situation didn&#39;t really warrant the added bloat of such a library for one date string, so I&#39;m happy with my decently proper solution.</p>
